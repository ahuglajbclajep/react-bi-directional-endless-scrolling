import{r as R,d as ge,j,l as ye,C as ee,i as Re,c as Ee,u as Se,T as be,S as Le,b as Ie}from"./ScriptSize-CMxQ7Jzi.js";const V=null,{min:H,max:O,abs:oe,floor:ke}=Math,ie=(e,t,r)=>H(r,O(t,e)),ue=e=>[...e].sort((t,r)=>t-r),ae=typeof queueMicrotask=="function"?queueMicrotask:e=>{Promise.resolve().then(e)},re=e=>{let t,r;return()=>(t||(t=!0,r=e()),r)},D=-1,F=(e,t,r)=>{const s=r?"unshift":"push";for(let o=0;o<t;o++)e[s](D);return e},$=(e,t)=>{const r=e.t[t];return r===D?e.o:r},Te=(e,t,r)=>{const s=e.t[t]===D;return e.t[t]=r,e.i=H(t,e.i),s},U=(e,t)=>{if(!e.l)return 0;if(e.i>=t)return e.u[t];e.i<0&&(e.u[0]=0,e.i=0);let r=e.i,s=e.u[r];for(;r<t;)s+=$(e,r),e.u[++r]=s;return e.i=t,s},Y=(e,t,r=0,s=e.l-1)=>{for(;r<=s;){const o=ke((r+s)/2),c=U(e,o);if(c<=t){if(c+$(e,o)>t)return o;r=o+1}else s=o-1}return ie(r,0,e.l-1)},le=(e,t,r)=>{const s=t-e.l;return e.i=r?-1:H(t-1,e.i),e.l=t,s>0?(F(e.u,s),F(e.t,s,r),e.o*s):(e.u.splice(s),(r?e.t.splice(0,-s):e.t.splice(s)).reduce((o,c)=>o-(c===D?e.o:c),0))},fe=typeof window<"u",de=()=>document.documentElement,je=e=>e.ownerDocument,Ce=e=>e.defaultView,he=re(()=>!!fe&&getComputedStyle(de()).direction==="rtl"),pe=re(()=>/iP(hone|od|ad)/.test(navigator.userAgent)),Me=re(()=>"scrollBehavior"in de().style),Ae=e=>O(e.h(),e.p()),Oe=e=>!!e.p(),ze=(e,t=40,r=4,s=0,o,c=!1)=>{let a=!!s,g=[],n=0,i=0,d=0,y=0,w=0,E=0,h=0,p=0,k=0,x=a?[0,O(s-1,0)]:V,T=[0,0],N=0;const I=((l,m,b)=>({o:b?b[1]:m,t:b&&b[0]?F(b[0].slice(0,H(l,b[0].length)),O(0,l-b[0].length)):F([],l),l,i:-1,u:F([],l)}))(e,t,o),X=new Set,v=()=>d-i,P=()=>v()+E+w,z=l=>((m,b,A,L)=>{if(L=H(L,m.l-1),U(m,L)<=b){const u=Y(m,b+A,L);return[Y(m,b,L,u),u]}{const u=Y(m,b,void 0,L);return[u,Y(m,b+A,u)]}})(I,l,n,T[0]),W=()=>(l=>l.l?U(l,l.l-1)+$(l,l.l-1):0)(I),q=l=>U(I,l)-E,_=l=>$(I,l),K=l=>{l&&(pe()&&p!==0?E+=l:(w+=l,y++))};return{v:()=>g,_:()=>(l=>[l.t.slice(),l.o])(I),m:()=>{if(h)return T;let[l,m]=z(O(0,P()));return x&&(l=H(l,x[0]),m=O(m,x[1])),p!==1&&(l-=O(0,r)),p!==2&&(m+=O(0,r)),T=[O(l,0),H(m,I.l-1)]},$:()=>Y(I,P()),S:()=>Y(I,P()+n),I:l=>I.t[l]===D,k:()=>!!x&&I.t.slice(O(0,x[0]-1),H(I.l-1,x[1]+1)+1).includes(D),T:q,R:_,M:()=>I.l,C:()=>d,H:()=>p!==0,p:()=>n,W:()=>i,h:W,J:()=>y,B:()=>(h=w,w=0,[h,k===2||v()+n>=W()]),O:(l,m)=>{const b=[l,m];return X.add(b),()=>{X.delete(b)}},L:(l,m)=>{let b,A,L=0;switch(l){case 1:{const u=h;h=0;const f=m-d,S=oe(f);u&&S<oe(u)+1||k!==0||(p=f<0?2:1),a&&(x=V,a=!1),d=m,L=4;const C=v();C>=-n&&C<=W()&&(L+=1,A=S>n);break}case 2:L=8,p!==0&&(b=!0,L+=1),p=0,k=0,x=V;break;case 3:{const u=m.filter(([f,S])=>I.t[f]!==S);if(!u.length)break;K(u.reduce((f,[S,C])=>((k===2||(x?!a&&S<x[0]:q(S)+(p===0&&k===0?_(S):0)<v()))&&(f+=C-_(S)),f),0));for(const[f,S]of u){const C=_(f),B=Te(I,f,S);c&&(N+=B?S:S-C)}c&&n&&N>n&&(K(((f,S)=>{let C=0;const B=[];f.t.forEach((se,xe)=>{se!==D&&(B.push(se),xe<S&&C++)}),f.i=-1;const J=ue(B),ne=J.length,Q=ne/2|0,me=ne%2==0?(J[Q-1]+J[Q])/2:J[Q],we=f.o;return((f.o=me)-we)*O(S-C,0)})(I,Y(I,P()))),c=!1),L=3,A=!0;break}case 4:n!==m&&(n=m,L=3);break;case 5:m[1]?(K(le(I,m[0],!0)),k=2,L=1):(le(I,m[0]),L=1);break;case 6:i=m;break;case 7:k=1;break;case 8:x=z(m),L=1}L&&(g=[],b&&E&&(w+=E,E=0,y++),X.forEach(([u,f])=>{L&u&&f(A)}))}}},te=setTimeout,Z=(e,t)=>t&&he()?-e:e,Be=(e,t,r,s,o,c)=>{const a=Date.now;let g=0,n=!1,i=!1,d=!1,y=!1;const w=(()=>{let x;const T=()=>{x!=V&&clearTimeout(x)},N=()=>{T(),x=te(()=>{x=V,(()=>{if(n||i)return n=!1,void w();d=!1,e.L(2)})()},150)};return N.P=T,N})(),E=()=>{g=a(),d&&(y=!0),e.L(1,s()),w()},h=x=>{if(n||!e.H()||x.ctrlKey)return;const T=a()-g;150>T&&50<T&&(r?x.deltaX:x.deltaY)&&(n=!0)},p=()=>{i=!0,d=y=!1},k=()=>{i=!1,pe()&&(d=!0)};return t.addEventListener("scroll",E),t.addEventListener("wheel",h,{passive:!0}),t.addEventListener("touchstart",p,{passive:!0}),t.addEventListener("touchend",k,{passive:!0}),{A:()=>{t.removeEventListener("scroll",E),t.removeEventListener("wheel",h),t.removeEventListener("touchstart",p),t.removeEventListener("touchend",k),w.P()},V:()=>{const[x,T]=e.B();x&&(o(Z(x,r),T,y),y=!1,T&&e.p()>e.h()&&e.L(1,s()))}}},Ne=(e,t)=>{let r,s,o;const c=t?"scrollLeft":"scrollTop",a=t?"overflowX":"overflowY",g=async(n,i)=>{if(!r)return void ae(()=>g(n,i));o&&o();const d=()=>{let y;return[new Promise((w,E)=>{y=w,o=E,Oe(e)&&te(E,150)}),e.O(2,()=>{y&&y()})]};if(i&&Me()){for(;e.L(8,n()),e.k();){const[y,w]=d();try{await y}catch{return}finally{w()}}r.scrollTo({[t?"left":"top"]:Z(n(),t),behavior:"smooth"})}else for(;;){const[y,w]=d();try{r[c]=Z(n(),t),e.L(7),await y}catch{return}finally{w()}}};return{X(n){r=n,s=Be(e,n,t,()=>Z(n[c],t),(i,d,y)=>{if(y){const w=n.style,E=w[a];w[a]="hidden",te(()=>{w[a]=E})}d?(n[c]=e.C()+i,o&&o()):n[c]+=i})},Y(){s&&s.A()},j(n){g(()=>n)},q(n){n+=e.C(),g(()=>n)},D(n,{align:i,smooth:d,offset:y=0}={}){if(n=ie(n,0,e.M()-1),i==="nearest"){const w=e.T(n),E=e.C();if(w<E)i="start";else{if(!(w+e.R(n)>E+e.p()))return;i="end"}}g(()=>y+e.W()+e.T(n)+(i==="end"?e.R(n)-e.p():i==="center"?(e.R(n)-e.p())/2:0),d)},U:()=>{s&&s.V()}}},Pe=e=>{let t;return{F(r){(t||(t=new(Ce(je(r))).ResizeObserver(e))).observe(r)},G(r){t.unobserve(r)},A(){t&&t.disconnect()}}},He=(e,t)=>{let r;const s=t?"width":"height",o=new WeakMap,c=Pe(a=>{const g=[];for(const{target:n,contentRect:i}of a)if(n.offsetParent)if(n===r)e.L(4,i[s]);else{const d=o.get(n);d!=V&&g.push([d,i[s]])}g.length&&e.L(3,g)});return{K(a){c.F(r=a)},N:(a,g)=>(o.set(a,g),c.F(a),()=>{o.delete(a),c.G(a)}),Y:c.A}},G=fe?R.useLayoutEffect:R.useEffect,M="current",ve=(e,t)=>{if(Array.isArray(e))for(const r of e)ve(r,t);else e==null||typeof e=="boolean"||t.push(e)},We=(e,t)=>{const r=e.key;return r??"_"+t},_e=e=>{const t=R.useRef();return t[M]||(t[M]=e())},ce=e=>{const t=R.useRef(e);return G(()=>{t[M]=e},[e]),t},Ye=R.memo(({Z:e,ee:t,te:r,ne:s,oe:o,re:c,ie:a,se:g})=>{const n=R.useRef(null);G(()=>t(n[M],r),[r]);const i=R.useMemo(()=>{const d={position:o&&g?void 0:"absolute",[a?"height":"width"]:"100%",[a?"top":"left"]:0,[a?he()?"right":"left":"top"]:s,visibility:!o||g?"visible":"hidden"};return a&&(d.display="flex"),d},[s,o,g,a]);return j.jsx(c,typeof c=="string"?{ref:n,style:i,children:e}:{ref:n,style:i,index:r,children:e})}),De=e=>R.useReducer(e.v,void 0,e.v)[1],Xe=(e,t)=>R.useMemo(()=>{if(typeof e=="function")return[e,t||0];const r=(s=>{const o=[];return ve(s,o),o})(e);return[s=>r[s],r.length]},[e,t]),Ke=R.forwardRef(({children:e,count:t,overscan:r,itemSize:s,shift:o,horizontal:c,keepMounted:a,cache:g,startMargin:n=0,ssrCount:i,as:d="div",item:y="div",scrollRef:w,onScroll:E,onScrollEnd:h},p)=>{const[k,x]=Xe(e,t),T=R.useRef(null),N=R.useRef(!!i),I=ce(E),X=ce(h),[v,P,z,W]=_e(()=>{const u=!!c,f=ze(x,s,r,i,g,!s);return[f,He(f,u),Ne(f,u),u]});x!==v.M()&&v.L(5,[x,o]),n!==v.W()&&v.L(6,n);const q=De(v),[_,K]=v.m(),l=v.H(),m=v.J(),b=v.h(),A=[],L=u=>{const f=k(u);return j.jsx(Ye,{ee:P.N,te:u,ne:v.T(u),oe:v.I(u),re:y,Z:f,ie:W,se:N[M]},We(f,u))};G(()=>{N[M]=!1;const u=v.O(1,B=>{B?ge.flushSync(q):q()}),f=v.O(4,()=>{I[M]&&I[M](v.C())}),S=v.O(8,()=>{X[M]&&X[M]()}),C=B=>{P.K(B),z.X(B)};return w?ae(()=>C(w[M])):C(T[M].parentElement),()=>{u(),f(),S(),P.Y(),z.Y()}},[]),G(()=>{z.U()},[m]),R.useImperativeHandle(p,()=>({get cache(){return v._()},get scrollOffset(){return v.C()},get scrollSize(){return Ae(v)},get viewportSize(){return v.p()},findStartIndex:v.$,findEndIndex:v.S,getItemOffset:v.T,getItemSize:v.R,scrollToIndex:z.D,scrollTo:z.j,scrollBy:z.q}),[]);for(let u=_,f=K;u<=f;u++)A.push(L(u));if(a){const u=[],f=[];ue(a).forEach(S=>{S<_&&u.push(L(S)),S>K&&f.push(L(S))}),A.unshift(...u),A.push(...f)}return j.jsx(d,{ref:T,style:{overflowAnchor:"none",flex:"none",position:"relative",visibility:"hidden",width:W?b:"100%",height:W?"100%":b,pointerEvents:l?"none":void 0},children:A})}),Ve=({initialIndex:e,handlerRef:t})=>{const r=R.useRef(null),[s,o]=R.useState([]),c=R.useRef(e),[a,g]=R.useState(!1),n=R.useRef(!1),i=R.useCallback(async(...h)=>{n.current=!0;const p=await ye(...h);return n.current=!1,p},[]),[d,y]=R.useState("load");R.useEffect(()=>{d==="load"&&(async()=>{const h=c.current-ee/2,p=await i("down",h);g(!1),o(p),c.current=h,y("postload")})()},[i,d]),R.useEffect(()=>{var h;d==="postload"&&((h=r.current)==null||h.scrollToIndex(ee/2,{align:"start"}),y("postload"))},[d]);const w=R.useCallback(async()=>{if(!r.current||n.current)return;const h=s.length;if(r.current.findEndIndex()+1===h){const p=await i("down",c.current+h);g(!1),o(k=>[...k,...p])}else if(r.current.findStartIndex()<=0){const p=await i("up",c.current);g(!0),o(k=>[...p,...k]),c.current=c.current-ee}},[i,s.length]),E=R.useCallback(async h=>{if(!r.current)return;const p=c.current;h>=p&&h<p+s.length?r.current.scrollToIndex(h-p,{align:"start"}):(c.current=h,y("load"))},[s.length]);return R.useImperativeHandle(t,()=>({scrollTo:E}),[E]),j.jsx("div",{className:"h-[300px] overflow-y-auto",children:j.jsx(Ke,{ref:r,onScroll:w,shift:a,children:s.map(h=>{const p=Number(h.split("#")[1]);return j.jsx("div",{style:Re(p),children:h},p)})})})},qe=()=>{const{handler:e,scrollTo:t}=Se();return j.jsxs("div",{className:"p-4 flex flex-col gap-1",children:[j.jsxs("div",{className:"flex items-center justify-between",children:[j.jsxs("div",{className:"flex items-end gap-2",children:[j.jsx(be,{name:"virtua",link:"https://github.com/inokawa/virtua"}),j.jsx(Le,{scriptName:"virtua"})]}),j.jsx(Ie,{scrollTo:t})]}),j.jsx(Ve,{initialIndex:500,handlerRef:e})]})};Ee.createRoot(document.getElementById("virtua")).render(j.jsx(qe,{}));
