import{r as x,b as ye,j as O,c as ge,l as xe,C as Ee,T as Re,S as be,i as Le}from"./ScrollPanel-DwnXDd2n.js";const V=null,{min:P,max:A,abs:se,floor:Ie}=Math,ce=(e,t,r)=>P(r,A(t,e)),ie=e=>[...e].sort((t,r)=>t-r),ue=typeof queueMicrotask=="function"?queueMicrotask:e=>{Promise.resolve().then(e)},te=e=>{let t,r;return()=>(t||(t=!0,r=e()),r)},X=-1,F=(e,t,r)=>{const s=r?"unshift":"push";for(let l=0;l<t;l++)e[s](X);return e},$=(e,t)=>{const r=e.t[t];return r===X?e.o:r},ke=(e,t,r)=>{const s=e.t[t]===X;return e.t[t]=r,e.i=P(t,e.i),s},U=(e,t)=>{if(!e.l)return 0;if(e.i>=t)return e.u[t];e.i<0&&(e.u[0]=0,e.i=0);let r=e.i,s=e.u[r];for(;r<t;)s+=$(e,r),e.u[++r]=s;return e.i=t,s},W=(e,t,r=0,s=e.l-1)=>{for(;r<=s;){const l=Ie((r+s)/2),h=U(e,l);if(h<=t){if(h+$(e,l)>t)return l;r=l+1}else s=l-1}return ce(r,0,e.l-1)},oe=(e,t,r)=>{const s=t-e.l;return e.i=r?-1:P(t-1,e.i),e.l=t,s>0?(F(e.u,s),F(e.t,s,r),e.o*s):(e.u.splice(s),(r?e.t.splice(0,-s):e.t.splice(s)).reduce((l,h)=>l-(h===X?e.o:h),0))},ae=typeof window<"u",fe=()=>document.documentElement,Se=e=>e.ownerDocument,Te=e=>e.defaultView,de=te(()=>!!ae&&getComputedStyle(fe()).direction==="rtl"),he=te(()=>/iP(hone|od|ad)/.test(navigator.userAgent)),Me=te(()=>"scrollBehavior"in fe().style),je=e=>A(e.h(),e.p()),Ce=e=>!!e.p(),Ae=(e,t=40,r=4,s=0,l,h=!1)=>{let u=!!s,y=[],n=0,i=0,w=0,g=0,o=0,a=0,I=0,S=0,T=0,m=u?[0,A(s-1,0)]:V,k=[0,0],z=0;const L=((c,v,R)=>({o:R?R[1]:v,t:R&&R[0]?F(R[0].slice(0,P(c,R[0].length)),A(0,c-R[0].length)):F([],c),l:c,i:-1,u:F([],c)}))(e,t,l),Y=new Set,p=()=>w-i,B=()=>p()+a+o,N=c=>((v,R,C,b)=>{if(b=P(b,v.l-1),U(v,b)<=R){const f=W(v,R+C,b);return[W(v,R,b,f),f]}{const f=W(v,R,void 0,b);return[f,W(v,R+C,f)]}})(L,c,n,k[0]),D=()=>(c=>c.l?U(c,c.l-1)+$(c,c.l-1):0)(L),q=c=>U(L,c)-a,H=c=>$(L,c),K=c=>{c&&(he()&&S!==0?a+=c:(o+=c,g++))};return{v:()=>y,_:()=>(c=>[c.t.slice(),c.o])(L),m:()=>{if(I)return k;let[c,v]=N(A(0,B()));return m&&(c=P(c,m[0]),v=A(v,m[1])),S!==1&&(c-=A(0,r)),S!==2&&(v+=A(0,r)),k=[A(c,0),P(v,L.l-1)]},$:()=>W(L,B()),S:()=>W(L,B()+n),I:c=>L.t[c]===X,k:()=>!!m&&L.t.slice(A(0,m[0]-1),P(L.l-1,m[1]+1)+1).includes(X),T:q,R:H,M:()=>L.l,C:()=>w,H:()=>S!==0,p:()=>n,W:()=>i,h:D,J:()=>g,B:()=>(I=o,o=0,[I,T===2||p()+n>=D()]),O:(c,v)=>{const R=[c,v];return Y.add(R),()=>{Y.delete(R)}},L:(c,v)=>{let R,C,b=0;switch(c){case 1:{const f=I;I=0;const d=v-w,E=se(d);f&&E<se(f)+1||T!==0||(S=d<0?2:1),u&&(m=V,u=!1),w=v,b=4;const M=p();M>=-n&&M<=D()&&(b+=1,C=E>n);break}case 2:b=8,S!==0&&(R=!0,b+=1),S=0,T=0,m=V;break;case 3:{const f=v.filter(([d,E])=>L.t[d]!==E);if(!f.length)break;K(f.reduce((d,[E,M])=>((T===2||(m?!u&&E<m[0]:q(E)+(S===0&&T===0?H(E):0)<p()))&&(d+=M-H(E)),d),0));for(const[d,E]of f){const M=H(d),_=ke(L,d,E);h&&(z+=_?E:E-M)}h&&n&&z>n&&(K(((d,E)=>{let M=0;const _=[];d.t.forEach((ne,me)=>{ne!==X&&(_.push(ne),me<E&&M++)}),d.i=-1;const J=ie(_),re=J.length,Q=re/2|0,ve=re%2==0?(J[Q-1]+J[Q])/2:J[Q],we=d.o;return((d.o=ve)-we)*A(E-M,0)})(L,W(L,B()))),h=!1),b=3,C=!0;break}case 4:n!==v&&(n=v,b=3);break;case 5:v[1]?(K(oe(L,v[0],!0)),T=2,b=1):(oe(L,v[0]),b=1);break;case 6:i=v;break;case 7:T=1;break;case 8:m=N(v),b=1}b&&(y=[],R&&a&&(o+=a,a=0,g++),Y.forEach(([f,d])=>{b&f&&d(C)}))}}},ee=setTimeout,Z=(e,t)=>t&&de()?-e:e,Oe=(e,t,r,s,l,h)=>{const u=Date.now;let y=0,n=!1,i=!1,w=!1,g=!1;const o=(()=>{let m;const k=()=>{m!=V&&clearTimeout(m)},z=()=>{k(),m=ee(()=>{m=V,(()=>{if(n||i)return n=!1,void o();w=!1,e.L(2)})()},150)};return z.P=k,z})(),a=()=>{y=u(),w&&(g=!0),e.L(1,s()),o()},I=m=>{if(n||!e.H()||m.ctrlKey)return;const k=u()-y;150>k&&50<k&&(r?m.deltaX:m.deltaY)&&(n=!0)},S=()=>{i=!0,w=g=!1},T=()=>{i=!1,he()&&(w=!0)};return t.addEventListener("scroll",a),t.addEventListener("wheel",I,{passive:!0}),t.addEventListener("touchstart",S,{passive:!0}),t.addEventListener("touchend",T,{passive:!0}),{A:()=>{t.removeEventListener("scroll",a),t.removeEventListener("wheel",I),t.removeEventListener("touchstart",S),t.removeEventListener("touchend",T),o.P()},V:()=>{const[m,k]=e.B();m&&(l(Z(m,r),k,g),g=!1,k&&e.p()>e.h()&&e.L(1,s()))}}},Ne=(e,t)=>{let r,s,l;const h=t?"scrollLeft":"scrollTop",u=t?"overflowX":"overflowY",y=async(n,i)=>{if(!r)return void ue(()=>y(n,i));l&&l();const w=()=>{let g;return[new Promise((o,a)=>{g=o,l=a,Ce(e)&&ee(a,150)}),e.O(2,()=>{g&&g()})]};if(i&&Me()){for(;e.L(8,n()),e.k();){const[g,o]=w();try{await g}catch{return}finally{o()}}r.scrollTo({[t?"left":"top"]:Z(n(),t),behavior:"smooth"})}else for(;;){const[g,o]=w();try{r[h]=Z(n(),t),e.L(7),await g}catch{return}finally{o()}}};return{X(n){r=n,s=Oe(e,n,t,()=>Z(n[h],t),(i,w,g)=>{if(g){const o=n.style,a=o[u];o[u]="hidden",ee(()=>{o[u]=a})}w?(n[h]=e.C()+i,l&&l()):n[h]+=i})},Y(){s&&s.A()},j(n){y(()=>n)},q(n){n+=e.C(),y(()=>n)},D(n,{align:i,smooth:w,offset:g=0}={}){if(n=ce(n,0,e.M()-1),i==="nearest"){const o=e.T(n),a=e.C();if(o<a)i="start";else{if(!(o+e.R(n)>a+e.p()))return;i="end"}}y(()=>g+e.W()+e.T(n)+(i==="end"?e.R(n)-e.p():i==="center"?(e.R(n)-e.p())/2:0),w)},U:()=>{s&&s.V()}}},_e=e=>{let t;return{F(r){(t||(t=new(Te(Se(r))).ResizeObserver(e))).observe(r)},G(r){t.unobserve(r)},A(){t&&t.disconnect()}}},ze=(e,t)=>{let r;const s=t?"width":"height",l=new WeakMap,h=_e(u=>{const y=[];for(const{target:n,contentRect:i}of u)if(n.offsetParent)if(n===r)e.L(4,i[s]);else{const w=l.get(n);w!=V&&y.push([w,i[s]])}y.length&&e.L(3,y)});return{K(u){h.F(r=u)},N:(u,y)=>(l.set(u,y),h.F(u),()=>{l.delete(u),h.G(u)}),Y:h.A}},G=ae?x.useLayoutEffect:x.useEffect,j="current",pe=(e,t)=>{if(Array.isArray(e))for(const r of e)pe(r,t);else e==null||typeof e=="boolean"||t.push(e)},Be=(e,t)=>{const r=e.key;return r??"_"+t},Pe=e=>{const t=x.useRef();return t[j]||(t[j]=e())},le=e=>{const t=x.useRef(e);return G(()=>{t[j]=e},[e]),t},De=x.memo(({Z:e,ee:t,te:r,ne:s,oe:l,re:h,ie:u,se:y})=>{const n=x.useRef(null);G(()=>t(n[j],r),[r]);const i=x.useMemo(()=>{const w={position:l&&y?void 0:"absolute",[u?"height":"width"]:"100%",[u?"top":"left"]:0,[u?de()?"right":"left":"top"]:s,visibility:!l||y?"visible":"hidden"};return u&&(w.display="flex"),w},[s,l,y,u]);return O.jsx(h,typeof h=="string"?{ref:n,style:i,children:e}:{ref:n,style:i,index:r,children:e})}),He=e=>x.useReducer(e.v,void 0,e.v)[1],We=(e,t)=>x.useMemo(()=>{if(typeof e=="function")return[e,t||0];const r=(s=>{const l=[];return pe(s,l),l})(e);return[s=>r[s],r.length]},[e,t]),Xe=x.forwardRef(({children:e,count:t,overscan:r,itemSize:s,shift:l,horizontal:h,keepMounted:u,cache:y,startMargin:n=0,ssrCount:i,as:w="div",item:g="div",scrollRef:o,onScroll:a,onScrollEnd:I},S)=>{const[T,m]=We(e,t),k=x.useRef(null),z=x.useRef(!!i),L=le(a),Y=le(I),[p,B,N,D]=Pe(()=>{const f=!!h,d=Ae(m,s,r,i,y,!s);return[d,ze(d,f),Ne(d,f),f]});m!==p.M()&&p.L(5,[m,l]),n!==p.W()&&p.L(6,n);const q=He(p),[H,K]=p.m(),c=p.H(),v=p.J(),R=p.h(),C=[],b=f=>{const d=T(f);return O.jsx(De,{ee:B.N,te:f,ne:p.T(f),oe:p.I(f),re:g,Z:d,ie:D,se:z[j]},Be(d,f))};G(()=>{z[j]=!1;const f=p.O(1,_=>{_?ye.flushSync(q):q()}),d=p.O(4,()=>{L[j]&&L[j](p.C())}),E=p.O(8,()=>{Y[j]&&Y[j]()}),M=_=>{B.K(_),N.X(_)};return o?ue(()=>M(o[j])):M(k[j].parentElement),()=>{f(),d(),E(),B.Y(),N.Y()}},[]),G(()=>{N.U()},[v]),x.useImperativeHandle(S,()=>({get cache(){return p._()},get scrollOffset(){return p.C()},get scrollSize(){return je(p)},get viewportSize(){return p.p()},findStartIndex:p.$,findEndIndex:p.S,getItemOffset:p.T,getItemSize:p.R,scrollToIndex:N.D,scrollTo:N.j,scrollBy:N.q}),[]);for(let f=H,d=K;f<=d;f++)C.push(b(f));if(u){const f=[],d=[];ie(u).forEach(E=>{E<H&&f.push(b(E)),E>K&&d.push(b(E))}),C.unshift(...f),C.push(...d)}return O.jsx(w,{ref:k,style:{overflowAnchor:"none",flex:"none",position:"relative",visibility:"hidden",width:D?R:"100%",height:D?"100%":R,pointerEvents:c?"none":void 0},children:C})}),Ye=500,Ke=()=>{const[e,t]=x.useState([]),r=x.useRef(Ye),[s,l]=x.useState(!1),h=x.useRef(!1),u=x.useCallback(async(...o)=>{h.current=!0;const a=await xe(...o);return h.current=!1,a},[]),[y,n]=x.useState(!1);x.useEffect(()=>{(async()=>{const o=await u("down",r.current);l(!1),t(o),n(!0)})()},[]),x.useEffect(()=>{w()},[y]);const i=x.useRef(null),w=x.useCallback(async()=>{if(!i.current||h.current)return;const o=e.length;if(i.current.findEndIndex()+1===o){const a=await u("down",r.current+o);l(!1),t(I=>[...I,...a])}else if(i.current.findStartIndex()===0){const a=await u("up",r.current);l(!0),t(I=>[...a,...I]),r.current=r.current-Ee}},[e]),g=x.useCallback(async o=>{if(!i.current)return;const a=r.current;if(o>=a&&o<a+e.length)i.current.scrollToIndex(o-a,{align:"start"});else{const I=await u("down",o);i.current.scrollTo(0),l(!1),t(I),r.current=o}},[e]);return O.jsxs("div",{className:"p-4 flex flex-col gap-1",children:[O.jsxs("div",{className:"flex items-center justify-between",children:[O.jsx(Re,{name:"virtua",link:"https://github.com/inokawa/virtua"}),O.jsx(be,{scrollTo:g})]}),O.jsx("div",{className:"h-[300px] overflow-y-auto",children:O.jsx(Xe,{ref:i,onScroll:w,shift:s,children:e.map(o=>{const a=Number(o.split("#")[1]);return O.jsx("div",{style:Le(a),children:o},a)})})})]})};ge.createRoot(document.getElementById("virtua")).render(O.jsx(Ke,{}));
