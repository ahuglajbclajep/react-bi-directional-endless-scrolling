import{r as R,d as ye,j,l as xe,C as ge,i as Re,c as Ee,u as be,T as Se,S as Le,b as ke}from"./ScriptSize-CMxQ7Jzi.js";const V=null,{min:H,max:O,abs:ne,floor:Ie}=Math,ce=(e,t,r)=>H(r,O(t,e)),ie=e=>[...e].sort((t,r)=>t-r),ue=typeof queueMicrotask=="function"?queueMicrotask:e=>{Promise.resolve().then(e)},te=e=>{let t,r;return()=>(t||(t=!0,r=e()),r)},D=-1,F=(e,t,r)=>{const n=r?"unshift":"push";for(let o=0;o<t;o++)e[n](D);return e},$=(e,t)=>{const r=e.t[t];return r===D?e.o:r},Te=(e,t,r)=>{const n=e.t[t]===D;return e.t[t]=r,e.i=H(t,e.i),n},U=(e,t)=>{if(!e.l)return 0;if(e.i>=t)return e.u[t];e.i<0&&(e.u[0]=0,e.i=0);let r=e.i,n=e.u[r];for(;r<t;)n+=$(e,r),e.u[++r]=n;return e.i=t,n},Y=(e,t,r=0,n=e.l-1)=>{for(;r<=n;){const o=Ie((r+n)/2),v=U(e,o);if(v<=t){if(v+$(e,o)>t)return o;r=o+1}else n=o-1}return ce(r,0,e.l-1)},oe=(e,t,r)=>{const n=t-e.l;return e.i=r?-1:H(t-1,e.i),e.l=t,n>0?(F(e.u,n),F(e.t,n,r),e.o*n):(e.u.splice(n),(r?e.t.splice(0,-n):e.t.splice(n)).reduce((o,v)=>o-(v===D?e.o:v),0))},ae=typeof window<"u",fe=()=>document.documentElement,je=e=>e.ownerDocument,Ce=e=>e.defaultView,de=te(()=>!!ae&&getComputedStyle(fe()).direction==="rtl"),he=te(()=>/iP(hone|od|ad)/.test(navigator.userAgent)),Me=te(()=>"scrollBehavior"in fe().style),Ae=e=>O(e.h(),e.p()),Oe=e=>!!e.p(),ze=(e,t=40,r=4,n=0,o,v=!1)=>{let c=!!n,w=[],s=0,a=0,y=0,f=0,d=0,E=0,x=0,g=0,I=0,m=c?[0,O(n-1,0)]:V,T=[0,0],B=0;const k=((l,p,S)=>({o:S?S[1]:p,t:S&&S[0]?F(S[0].slice(0,H(l,S[0].length)),O(0,l-S[0].length)):F([],l),l,i:-1,u:F([],l)}))(e,t,o),X=new Set,h=()=>y-a,P=()=>h()+E+d,z=l=>((p,S,A,L)=>{if(L=H(L,p.l-1),U(p,L)<=S){const i=Y(p,S+A,L);return[Y(p,S,L,i),i]}{const i=Y(p,S,void 0,L);return[i,Y(p,S+A,i)]}})(k,l,s,T[0]),_=()=>(l=>l.l?U(l,l.l-1)+$(l,l.l-1):0)(k),q=l=>U(k,l)-E,W=l=>$(k,l),K=l=>{l&&(he()&&g!==0?E+=l:(d+=l,f++))};return{v:()=>w,_:()=>(l=>[l.t.slice(),l.o])(k),m:()=>{if(x)return T;let[l,p]=z(O(0,P()));return m&&(l=H(l,m[0]),p=O(p,m[1])),g!==1&&(l-=O(0,r)),g!==2&&(p+=O(0,r)),T=[O(l,0),H(p,k.l-1)]},$:()=>Y(k,P()),S:()=>Y(k,P()+s),I:l=>k.t[l]===D,k:()=>!!m&&k.t.slice(O(0,m[0]-1),H(k.l-1,m[1]+1)+1).includes(D),T:q,R:W,M:()=>k.l,C:()=>y,H:()=>g!==0,p:()=>s,W:()=>a,h:_,J:()=>f,B:()=>(x=d,d=0,[x,I===2||h()+s>=_()]),O:(l,p)=>{const S=[l,p];return X.add(S),()=>{X.delete(S)}},L:(l,p)=>{let S,A,L=0;switch(l){case 1:{const i=x;x=0;const u=p-y,b=ne(u);i&&b<ne(i)+1||I!==0||(g=u<0?2:1),c&&(m=V,c=!1),y=p,L=4;const C=h();C>=-s&&C<=_()&&(L+=1,A=b>s);break}case 2:L=8,g!==0&&(S=!0,L+=1),g=0,I=0,m=V;break;case 3:{const i=p.filter(([u,b])=>k.t[u]!==b);if(!i.length)break;K(i.reduce((u,[b,C])=>((I===2||(m?!c&&b<m[0]:q(b)+(g===0&&I===0?W(b):0)<h()))&&(u+=C-W(b)),u),0));for(const[u,b]of i){const C=W(u),N=Te(k,u,b);v&&(B+=N?b:b-C)}v&&s&&B>s&&(K(((u,b)=>{let C=0;const N=[];u.t.forEach((se,we)=>{se!==D&&(N.push(se),we<b&&C++)}),u.i=-1;const J=ie(N),re=J.length,Q=re/2|0,ve=re%2==0?(J[Q-1]+J[Q])/2:J[Q],me=u.o;return((u.o=ve)-me)*O(b-C,0)})(k,Y(k,P()))),v=!1),L=3,A=!0;break}case 4:s!==p&&(s=p,L=3);break;case 5:p[1]?(K(oe(k,p[0],!0)),I=2,L=1):(oe(k,p[0]),L=1);break;case 6:a=p;break;case 7:I=1;break;case 8:m=z(p),L=1}L&&(w=[],S&&E&&(d+=E,E=0,f++),X.forEach(([i,u])=>{L&i&&u(A)}))}}},ee=setTimeout,Z=(e,t)=>t&&de()?-e:e,Ne=(e,t,r,n,o,v)=>{const c=Date.now;let w=0,s=!1,a=!1,y=!1,f=!1;const d=(()=>{let m;const T=()=>{m!=V&&clearTimeout(m)},B=()=>{T(),m=ee(()=>{m=V,(()=>{if(s||a)return s=!1,void d();y=!1,e.L(2)})()},150)};return B.P=T,B})(),E=()=>{w=c(),y&&(f=!0),e.L(1,n()),d()},x=m=>{if(s||!e.H()||m.ctrlKey)return;const T=c()-w;150>T&&50<T&&(r?m.deltaX:m.deltaY)&&(s=!0)},g=()=>{a=!0,y=f=!1},I=()=>{a=!1,he()&&(y=!0)};return t.addEventListener("scroll",E),t.addEventListener("wheel",x,{passive:!0}),t.addEventListener("touchstart",g,{passive:!0}),t.addEventListener("touchend",I,{passive:!0}),{A:()=>{t.removeEventListener("scroll",E),t.removeEventListener("wheel",x),t.removeEventListener("touchstart",g),t.removeEventListener("touchend",I),d.P()},V:()=>{const[m,T]=e.B();m&&(o(Z(m,r),T,f),f=!1,T&&e.p()>e.h()&&e.L(1,n()))}}},Be=(e,t)=>{let r,n,o;const v=t?"scrollLeft":"scrollTop",c=t?"overflowX":"overflowY",w=async(s,a)=>{if(!r)return void ue(()=>w(s,a));o&&o();const y=()=>{let f;return[new Promise((d,E)=>{f=d,o=E,Oe(e)&&ee(E,150)}),e.O(2,()=>{f&&f()})]};if(a&&Me()){for(;e.L(8,s()),e.k();){const[f,d]=y();try{await f}catch{return}finally{d()}}r.scrollTo({[t?"left":"top"]:Z(s(),t),behavior:"smooth"})}else for(;;){const[f,d]=y();try{r[v]=Z(s(),t),e.L(7),await f}catch{return}finally{d()}}};return{X(s){r=s,n=Ne(e,s,t,()=>Z(s[v],t),(a,y,f)=>{if(f){const d=s.style,E=d[c];d[c]="hidden",ee(()=>{d[c]=E})}y?(s[v]=e.C()+a,o&&o()):s[v]+=a})},Y(){n&&n.A()},j(s){w(()=>s)},q(s){s+=e.C(),w(()=>s)},D(s,{align:a,smooth:y,offset:f=0}={}){if(s=ce(s,0,e.M()-1),a==="nearest"){const d=e.T(s),E=e.C();if(d<E)a="start";else{if(!(d+e.R(s)>E+e.p()))return;a="end"}}w(()=>f+e.W()+e.T(s)+(a==="end"?e.R(s)-e.p():a==="center"?(e.R(s)-e.p())/2:0),y)},U:()=>{n&&n.V()}}},Pe=e=>{let t;return{F(r){(t||(t=new(Ce(je(r))).ResizeObserver(e))).observe(r)},G(r){t.unobserve(r)},A(){t&&t.disconnect()}}},He=(e,t)=>{let r;const n=t?"width":"height",o=new WeakMap,v=Pe(c=>{const w=[];for(const{target:s,contentRect:a}of c)if(s.offsetParent)if(s===r)e.L(4,a[n]);else{const y=o.get(s);y!=V&&w.push([y,a[n]])}w.length&&e.L(3,w)});return{K(c){v.F(r=c)},N:(c,w)=>(o.set(c,w),v.F(c),()=>{o.delete(c),v.G(c)}),Y:v.A}},G=ae?R.useLayoutEffect:R.useEffect,M="current",pe=(e,t)=>{if(Array.isArray(e))for(const r of e)pe(r,t);else e==null||typeof e=="boolean"||t.push(e)},_e=(e,t)=>{const r=e.key;return r??"_"+t},We=e=>{const t=R.useRef();return t[M]||(t[M]=e())},le=e=>{const t=R.useRef(e);return G(()=>{t[M]=e},[e]),t},Ye=R.memo(({Z:e,ee:t,te:r,ne:n,oe:o,re:v,ie:c,se:w})=>{const s=R.useRef(null);G(()=>t(s[M],r),[r]);const a=R.useMemo(()=>{const y={position:o&&w?void 0:"absolute",[c?"height":"width"]:"100%",[c?"top":"left"]:0,[c?de()?"right":"left":"top"]:n,visibility:!o||w?"visible":"hidden"};return c&&(y.display="flex"),y},[n,o,w,c]);return j.jsx(v,typeof v=="string"?{ref:s,style:a,children:e}:{ref:s,style:a,index:r,children:e})}),De=e=>R.useReducer(e.v,void 0,e.v)[1],Xe=(e,t)=>R.useMemo(()=>{if(typeof e=="function")return[e,t||0];const r=(n=>{const o=[];return pe(n,o),o})(e);return[n=>r[n],r.length]},[e,t]),Ke=R.forwardRef(({children:e,count:t,overscan:r,itemSize:n,shift:o,horizontal:v,keepMounted:c,cache:w,startMargin:s=0,ssrCount:a,as:y="div",item:f="div",scrollRef:d,onScroll:E,onScrollEnd:x},g)=>{const[I,m]=Xe(e,t),T=R.useRef(null),B=R.useRef(!!a),k=le(E),X=le(x),[h,P,z,_]=We(()=>{const i=!!v,u=ze(m,n,r,a,w,!n);return[u,He(u,i),Be(u,i),i]});m!==h.M()&&h.L(5,[m,o]),s!==h.W()&&h.L(6,s);const q=De(h),[W,K]=h.m(),l=h.H(),p=h.J(),S=h.h(),A=[],L=i=>{const u=I(i);return j.jsx(Ye,{ee:P.N,te:i,ne:h.T(i),oe:h.I(i),re:f,Z:u,ie:_,se:B[M]},_e(u,i))};G(()=>{B[M]=!1;const i=h.O(1,N=>{N?ye.flushSync(q):q()}),u=h.O(4,()=>{k[M]&&k[M](h.C())}),b=h.O(8,()=>{X[M]&&X[M]()}),C=N=>{P.K(N),z.X(N)};return d?ue(()=>C(d[M])):C(T[M].parentElement),()=>{i(),u(),b(),P.Y(),z.Y()}},[]),G(()=>{z.U()},[p]),R.useImperativeHandle(g,()=>({get cache(){return h._()},get scrollOffset(){return h.C()},get scrollSize(){return Ae(h)},get viewportSize(){return h.p()},findStartIndex:h.$,findEndIndex:h.S,getItemOffset:h.T,getItemSize:h.R,scrollToIndex:z.D,scrollTo:z.j,scrollBy:z.q}),[]);for(let i=W,u=K;i<=u;i++)A.push(L(i));if(c){const i=[],u=[];ie(c).forEach(b=>{b<W&&i.push(L(b)),b>K&&u.push(L(b))}),A.unshift(...i),A.push(...u)}return j.jsx(y,{ref:T,style:{overflowAnchor:"none",flex:"none",position:"relative",visibility:"hidden",width:_?S:"100%",height:_?"100%":S,pointerEvents:l?"none":void 0},children:A})}),Ve=({initialIndex:e,handlerRef:t})=>{const[r,n]=R.useState([]),o=R.useRef(e),[v,c]=R.useState(!1),w=R.useRef(!1),s=R.useCallback(async(...x)=>{w.current=!0;const g=await xe(...x);return w.current=!1,g},[]),[a,y]=R.useState(!1);R.useEffect(()=>{(async()=>{const x=await s("down",o.current);c(!1),n(x),y(!0)})()},[]),R.useEffect(()=>{d()},[a]);const f=R.useRef(null),d=R.useCallback(async()=>{if(!f.current||w.current)return;const x=r.length;if(f.current.findEndIndex()+1===x){const g=await s("down",o.current+x);c(!1),n(I=>[...I,...g])}else if(f.current.findStartIndex()===0){const g=await s("up",o.current);c(!0),n(I=>[...g,...I]),o.current=o.current-ge}},[r]),E=R.useCallback(async x=>{if(!f.current)return;const g=o.current;if(x>=g&&x<g+r.length)f.current.scrollToIndex(x-g,{align:"start"});else{const I=await s("down",x);f.current.scrollTo(0),c(!1),n(I),o.current=x}},[r]);return R.useImperativeHandle(t,()=>({scrollTo:E}),[E]),j.jsx("div",{className:"h-[300px] overflow-y-auto",children:j.jsx(Ke,{ref:f,onScroll:d,shift:v,children:r.map(x=>{const g=Number(x.split("#")[1]);return j.jsx("div",{style:Re(g),children:x},g)})})})},qe=()=>{const{handler:e,scrollTo:t}=be();return j.jsxs("div",{className:"p-4 flex flex-col gap-1",children:[j.jsxs("div",{className:"flex items-center justify-between",children:[j.jsxs("div",{className:"flex items-end gap-2",children:[j.jsx(Se,{name:"virtua",link:"https://github.com/inokawa/virtua"}),j.jsx(Le,{scriptName:"virtua"})]}),j.jsx(ke,{scrollTo:t})]}),j.jsx(Ve,{initialIndex:500,handlerRef:e})]})};Ee.createRoot(document.getElementById("virtua")).render(j.jsx(qe,{}));
